<html>

<head>
  <title>Is it snowing in St. Johns</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2822592648025998"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="index.css" />
  <script type="text/javascript">
    // Constants
    const API_URL = "https://api.weather.gov/gridpoints/PQR/110,107/forecast";
    const SNOW_WORDS = ["Snow", "Light Snow", "Rain And Snow"];

    $(document).ready(function () {
      // Show loading GIF when AJAX request starts
      $.ajaxSetup({
        beforeSend: function () {
          $('#loading').show();
        },
        complete: function () {
          $('#loading').hide();
        }
      });

      $.ajax({
        dataType: 'json',
        url: API_URL,
        success: function (data) {
          updateWeather(data);
        },
        error: function (jqXHR, textStatus, errorThrown) {
          handleError(errorThrown);
        }
      });

      // Toggle forecast visibility
      $('#toggleForecast').click(function () {
        $('#weeklyForecast').slideToggle();
        $(this).text($(this).text() === 'Show Weekly Forecast' ? 'Hide Weekly Forecast' : 'Show Weekly Forecast');
      });
    });

    function updateWeather(data) {
      const weather = data.properties.periods[0].shortForecast;
      const isSnowing = SNOW_WORDS.some(word => weather.toLowerCase().includes(word.toLowerCase()));

      if (isSnowing) {
        $('#yes').show();
        $('#no').hide();
        $('body').addClass('red');
      } else {
        $('#yes').hide();
        $('#no').show();
        $('body').removeClass('red').addClass('green');
      }

      $('#weatherContent').text(data.properties.periods[0].detailedForecast);
      $('#icon').attr('src', data.properties.periods[0].icon);

      // Populate weekly forecast
      const periods = data.properties.periods;
      let forecastHTML = '';

      for (let i = 0; i < Math.min(periods.length, 14); i++) {
        const period = periods[i];
        const hasSnow = SNOW_WORDS.some(word => period.shortForecast.toLowerCase().includes(word.toLowerCase()));
        const snowIndicator = hasSnow ? '❄️ ' : '';

        forecastHTML += `
          <div class="forecast-item">
            <div class="forecast-header">
              <img src="${period.icon}" alt="${period.shortForecast}" class="forecast-icon">
              <h3>${snowIndicator}${period.name}</h3>
            </div>
            <p class="temperature">${period.temperature}°${period.temperatureUnit}</p>
            <p class="short-forecast">${period.shortForecast}</p>
            <p class="detailed-forecast">${period.detailedForecast}</p>
            <p class="wind">Wind: ${period.windSpeed} ${period.windDirection}</p>
          </div>
        `;
      }

      $('#forecastContent').html(forecastHTML);
    }

    function handleError(error) {
      console.error("Error fetching weather data:", error);
      $('#weatherContent').text("Failed to load weather information. Please try again later.");
      $('body').addClass('green-background');
    }
  </script>
</head>

<body id="body">
  <div id="yes" style="display:none" class="red">
    <h1 class="yes"><span style='font-size:250px'>YES!</span><br />
      <img src="snow.gif" />
    </h1>
  </div>
  <div id="no" style="display:none" class="green">
    <h1 class="no"><span style='font-size:100px'>NO!</span></h1>
  </div>

  <button id="toggleForecast">Show Weekly Forecast</button>


  <div id="weeklyForecast">
    <h2>St. Johns Weather Forecast</h2>
    <div id="forecastContent"></div>
  </div>

  <div id="loading"
    style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:999;"
    class="yellow">
    <img src="winter.gif" alt="Loading..." />
  </div>
</body>

</html>